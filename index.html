<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Farias' Song Interface</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  <style>
    :root { --blue: #0d6efd; --green: #198754; --light-green: #e2f0e8; --gray: #6c757d; --yellow: #ffc107; --orange: #fd7e14; --purple: #6f42c1; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f4f7f9; padding-bottom: 150px; /* Space for debug panel */ }
    .main-container { padding: 10px; }
    .tab-buttons { display: flex; border-bottom: 2px solid #dee2e6; background-color: white; }
    .tab-button { flex: 1; text-align: center; background: none; border: none; padding: 12px 15px; cursor: pointer; font-size: 16px; color: var(--gray); }
    .tab-button.active { font-weight: bold; color: var(--blue); border-bottom: 3px solid var(--blue); }
    .tab-content { display: none; padding: 15px 10px; }
    .tab-content.active { display: block; }
    .action-buttons { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
    .action-buttons button { padding: 10px 12px; font-size: 14px; border: none; border-radius: 8px; cursor: pointer; background-color: var(--yellow); color: #000; flex-grow: 1; }
    #searchBox { width: 100%; box-sizing: border-box; padding: 12px; margin-bottom: 15px; font-size: 16px; border: 1px solid #ced4da; border-radius: 8px; }
    .toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 1001; left: 50%; transform: translateX(-50%); bottom: 30px; transition: visibility 0.5s, opacity 0.5s linear; opacity: 0;}
    .toast.show { visibility: visible; opacity: 1; }
    #backToTopBtn { display: none; position: fixed; bottom: 20px; right: 30px; z-index: 100; border: none; outline: none; background-color: var(--purple); color: white; cursor: pointer; padding: 10px; border-radius: 50%; font-size: 18px; width: 50px; height: 50px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    
    .list-header-banner { display: flex; justify-content: space-between; align-items: center; padding: 0 5px; margin-bottom: 15px; }
    .banner-title-group { display: flex; align-items: baseline; gap: 10px; }
    .banner-title { margin: 0; font-size: 1.8em; color: #343a40; }
    .banner-song-count { font-size: 1em; color: var(--gray); font-weight: 500; }
    #userAvatarDisplay { font-size: 1.5em; cursor: pointer; padding: 4px; border-radius: 4px; transition: background-color 0.2s; }
    #userAvatarDisplay:hover { background-color: #e9ecef; }
    
    .sort-buttons { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
    .sort-buttons button { background: #e9ecef; border: 1px solid #dee2e6; padding: 8px 12px; border-radius: 6px; cursor: pointer; flex-grow: 1;}
    #upNextFavoriteSortButton button.active { background-color: var(--purple); color: white; border-color: var(--purple); }
    .sort-buttons button.active { background: var(--blue); color: white; border-color: var(--blue); }

    /* --- Song List & Skeletons --- */
    .song-list-container { display: flex; flex-direction: column; gap: 8px; }
    .song-card, .skeleton-card { background-color: white; border-radius: 8px; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .song-card.is-in-queue { background-color: var(--light-green); border-left: 4px solid var(--green); }
    .skeleton-card .skeleton { background-color: #e9ecef; border-radius: 4px; }
    .skeleton-card .skeleton-title { height: 20px; width: 60%; margin-bottom: 8px; }
    .skeleton-card .skeleton-artist { height: 16px; width: 40%; }
    .skeleton-card .skeleton-actions .skeleton { width: 40px; height: 40px; border-radius: 50%; margin-left: 8px; }
    @keyframes shimmer { 0% { background-position: -1000px 0; } 100% { background-position: 1000px 0; } }
    .skeleton { background: linear-gradient(to right, #e9ecef 8%, #f8f9fa 18%, #e9ecef 33%); background-size: 2000px 100%; animation: shimmer 2s infinite linear; }

    /* --- Redesigned Request Button --- */
    .request-btn { background-color: transparent; border: none; color: var(--blue); border-radius: 50%; width: 40px; height: 40px; font-size: 30px; font-weight: 300; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; justify-content: center; padding-bottom: 4px; }
    .request-btn:hover:not(:disabled) { background-color: #e9ecef; }
    .request-btn.requested { color: var(--green); font-weight: normal; }
    .request-btn:disabled { color: var(--gray); opacity: 0.4; cursor: not-allowed; }
    .favorite-btn { background: none; border: none; font-size: 28px; cursor: pointer; color: var(--gray); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; padding: 0; }
    .favorite-btn.favorited { color: var(--yellow); }
    
    /* --- Genre Filters --- */
    #genreFilterAccordion { border: 1px solid #dee2e6; border-radius: 8px; margin-bottom: 15px; background-color: #fff; }
    #genreFilterAccordion summary { 
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px; 
        font-weight: bold; 
        cursor: pointer; 
        list-style: none; /* Hide the default triangle */
    }
    #genreFilterAccordion summary::-webkit-details-marker { display: none; } /* Hide for Safari */
    #genreFilterAccordion summary::after { content: '▾'; /* Add custom arrow */ }
    #genreFilterAccordion[open] summary::after { content: '▴'; }
    #clearFiltersBtn { background: none; border: none; color: var(--blue); cursor: pointer; font-size: 0.9em; padding: 4px 0px; }
    #genreFilterContainer { padding: 0 12px 12px; }
    .filter-btn-group { display: flex; }
    .filter-btn { background: #e9ecef; border: 1px solid #dee2e6; padding: 8px 12px; border-radius: 6px 0 0 6px; cursor: pointer; }
    .filter-btn.active { background: var(--blue); color: white; border-color: var(--blue); }
    .sub-genre-toggle { background: #e9ecef; border: 1px solid #dee2e6; border-left: none; padding: 8px; border-radius: 0 6px 6px 0; cursor: pointer; }
    .sub-genre-toggle.expanded { background-color: #d3d9df; }
    .sub-genre-container { display: none; flex-basis: 100%; padding: 8px 0 0 20px; }
    .sub-genre-container.show { display: block; }
    .sub-filter-btn { background: #f8f9fa; border: 1px solid #dee2e6; padding: 6px 10px; border-radius: 6px; cursor: pointer; margin-right: 6px; margin-bottom: 6px; }
    .sub-filter-btn.active { background: var(--purple); color: white; border-color: var(--purple); }

    /* --- "Up Next" Tab --- */
    #playNextBtn { background-color: var(--green); color: white; font-weight: bold; width: 100%; }
    .up-next-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
    .up-next-sort-controls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    #upNextList li { display: flex; align-items: center; justify-content: space-between; border: 1px solid #ddd; padding: 10px; margin-bottom: 8px; background: #fff; border-radius: 8px; cursor: grab; position: relative; }
    .unrequest-btn { background: none; border: none; font-size: 1.5em; color: var(--gray); cursor: pointer; opacity: 0.6; padding: 0 10px; }
    .unrequest-btn:hover:not(:disabled) { opacity: 1; color: #dc3545; }
    .unrequest-btn:disabled { color: #ccc; cursor: not-allowed; opacity: 0.4; }
    .request-avatar { font-size: 1.2em; margin-right: 8px; }
    #upNextList li.now-playing { background-color: #e7f1ff; border-left: 4px solid var(--blue); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .now-playing-tag { background-color: var(--blue); color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.8em; font-weight: bold; margin-right: 10px; white-space: nowrap; }
    .progress-bar-container { position: absolute; bottom: 0; left: 0; width: 100%; height: 4px; background-color: rgba(0, 0, 0, 0.1); border-radius: 0 0 8px 8px; overflow: hidden; }
    .progress-bar { width: 100%; height: 100%; background-color: var(--green); transform-origin: left; transform: scaleX(0); transition: transform 0.2s linear; }

    /* --- Admin Mode --- */
    .admin-only { display: none !important; } /* Hide by default with high specificity */
    body.is-admin .admin-only { display: flex !important; }
    .admin-queue-actions { display: flex; gap: 4px; margin-right: 8px; }
    .admin-queue-actions button { background: none; border: 1px solid var(--gray); border-radius: 4px; padding: 2px 6px; font-size: 0.8em; cursor: pointer; }

    /* --- Avatar Modal --- */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1050; display: none; align-items: center; justify-content: center; }
    .modal-content { background: white; padding: 20px; border-radius: 8px; max-width: 90%; max-height: 80vh; overflow-y: auto; }
    .avatar-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 10px; }
    .avatar-option { font-size: 36px; cursor: pointer; padding: 5px; border-radius: 8px; text-align: center; transition: background-color 0.2s; }
    .avatar-option:hover { background-color: #e9ecef; }
    
    #songTooltip { display: none; position: absolute; background: #222; color: white; padding: 10px; border-radius: 6px; z-index: 1000; font-size: 0.9em; max-width: 250px; pointer-events: none; }
    
    /* --- Responsive --- */
    @media (max-width: 767px) { #backToTopBtn { right: 50%; transform: translateX(50%); bottom: 20px; } }
    @media (min-width: 768px) {
        #mainSortButtons { display: none; }
        .song-list-container { display: none; }
        #songTable { display: table; width: 100%; border-collapse: collapse; table-layout: fixed; }
        #songTable th, #songTable td { border-bottom: 1px solid #dee2e6; text-align: left; vertical-align: middle; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 12px; }
        #songTable th:not(:last-child), #songTable td:not(:last-child) { border-right: 1px solid #dee2e6; }
        #songTable th:first-child, #songTable td:first-child { width: 140px; white-space: normal; }
        #songTable tr.is-in-queue { background-color: var(--light-green); }
        #songTable th[data-sort-field] { cursor: pointer; }
        #songTable th .sort-asc::after { content: ' ▲'; font-size: 0.8em; }
        #songTable th .sort-desc::after { content: ' ▼'; font-size: 0.8em; }
        .actions-header { display: flex; justify-content: space-between; align-items: center; }
        .actions-sorters { display: flex; }
        .actions-sorters button { background: none; border: 1px solid transparent; font-size: 1.2em; cursor: pointer; border-radius: 4px; position: relative; }
        .actions-sorters button:hover { border-color: #ccc; }
        .actions-sorters button.active { background-color: var(--blue); color: white; }
    }
  </style>
</head>


<body class="">
  
  <div class="tab-buttons">
    <button class="tab-button active" data-tab="SongListTab">Song List</button>
    <button class="tab-button" data-tab="UpNextTab">Up Next</button>
  </div>

  <div class="main-container">
    <div id="SongListTab" class="tab-content active">
      <div class="list-header-banner">
          <div class="banner-title-group">
              <h2 class="banner-title">Farias' Song List</h2>
              <span id="userAvatarDisplay" class="banner-song-count"></span>
              <span id="songCount" class="banner-song-count">0 songs</span>
          </div>
      </div>
      <div class="sort-buttons" id="mainSortButtons">
        <button class="sort-btn active" data-sort-field="Artist">Sort by Artist</button>
        <button class="sort-btn" data-sort-field="Name">Sort by Title</button>
        <button id="randomizeViewBtn">Randomize View</button>
      </div>
      
      <input type="text" id="searchBox" placeholder="Search for a song...">
      
      <details id="genreFilterAccordion">
        <div class="genre-filter-header">
            <summary>Filter by Genre</summary>
            <button id="clearFiltersBtn">Clear Filters</button>
        </div>
        <div id="genreFilterContainer"></div>
      </details>

      <div class="action-buttons admin-only">
          <button id="unhideBtn">Unhide</button>
          <button id="requestRandomBtn">Request 10 Random</button>
          <button id="addFavoritesBtn">Request Favorites</button>
      </div>
      <div id="songListContainer"></div>
      <table id="songTable">
        <thead>
            <tr>
                <th>
                    <div class="actions-header">
                        <span>Favorite / Request</span>
                        <div class="actions-sorters admin-only">
                            <button data-sort-primary="favorite" title="Sort by Favorite">☆</button>
                            <button data-sort-primary="requested" title="Sort by Requested">✓</button>
                        </div>
                    </div>
                </th>
                <th data-sort-field="Artist">Artist</th>
                <th data-sort-field="Name">Title</th>
            </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="UpNextTab" class="tab-content">
      <div class="list-header-banner">
          <div class="banner-title-group">
              <h2 class="banner-title">Farias' Song List</h2>
              <span id="songCountUpNext" class="banner-song-count">0 songs</span>
          </div>
      </div>
      <div class="up-next-controls">
        <div class="up-next-sort-controls admin-only">
            <div class="sort-buttons" id="upNextTimeSortButtons">
                <button class="sort-btn" data-sort="least-recent">Oldest First</button>
                <button class="sort-btn" data-sort="most-recent">Newest First</button>
                <button class="sort-btn" data-sort="random">Random Order</button>
            </div>
            <div class="sort-buttons" id="upNextFavoriteSortButton">
                <button class="sort-btn" data-sort="favorites-top">Favorites to Top</button>
            </div>
        </div>
        <div class="admin-only" style="flex-direction:column; gap: 8px;">
            <div class="action-buttons">
              <button id="clearFavoritesBtn">Clear Favorites</button>
              <button id="clearRandomBtn">Clear Random</button>
              <button id="clearAllBtn">Clear All</button>
              <button id="clearByUserBtn">Clear by User...</button>
            </div>
            <button id="playNextBtn">Play Next →</button>
        </div>
      </div>
      <ul id="upNextList"></ul>
    </div>
  </div>
  
  <div id="toast" class="toast"></div>
  <button id="backToTopBtn">↑</button>
  <div id="songTooltip" class="tooltip"></div>
  
  <div id="avatarModal" class="modal-overlay">
    <div class="modal-content">
        <h3>Choose Your Icon</h3>
        <div id="avatarGrid" class="avatar-grid"></div>
    </div>
  </div>
  
  <div id="clearUserModal" class="modal-overlay">
    <div class="modal-content">
        <h3>Clear All Songs By...</h3>
        <div id="clearUserGrid" class="avatar-grid"></div>
    </div>
  </div>

  <div id="debugPanel" class="admin-only">
    <div class="debug-header">
        <h4>Debug Log</h4>
        <button id="copyDebugLog">Copy Log</button>
    </div>
    <pre id="debugLog"></pre>
  </div>

  <script type="module" src="js/main.js"></script>
</body>
</html>